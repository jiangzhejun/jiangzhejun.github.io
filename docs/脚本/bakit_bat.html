<html>

<head>
  <link rel='stylesheet' href='../../inc/code.css'>
  <link rel='stylesheet' href='../../inc/default.css'>
  <meta charset="utf-8">
  <title>bakit.bat</title>
</head>

<body>
  <pre class='code'>@<span class='wbk_internal_command'>echo</span> off & <span class='wbk_internal_command'>title</span> %~n0 - bi202102241045

<span class='wbk_internal_command'>pushd</span> %~1 & <span class='wbk_internal_command'>for</span> %%o in (.) do <span class='wbk_internal_command'>set</span> src=%%~no
<span class='wbk_internal_command'>set</span> ymd=%<span class='wbk_internal_command'>date</span>:~,4%%<span class='wbk_internal_command'>date</span>:~5,2%%<span class='wbk_internal_command'>date</span>:~8,2%
<span class='wbk_internal_command'>set</span> home=E:&#92;bibi&#92;bak

<span class='wbk_internal_command'>set</span> dest=%home%&#92;%src%_%ymd%.7z
<span class='wbk_internal_command'>set</span> params=-mx9

<span class='wbk_internal_command'>if</span> exist %src%.nobak (
  <span class='wbk_internal_command'>set</span> params=%params% -xr@%src%.nobak
)

forfiles /p %home% /m %src%_*.7z -d -30 /c "<span class='wbk_external_command'>cmd</span> /c <span class='wbk_internal_command'>del</span> /f @<span class='wbk_internal_command'>path</span>"
7z a "%dest%" %params% %<span class='wbk_internal_command'>cd</span>%&#92;*
<span class='wbk_internal_command'>exit</span> /b 0</pre>
</body>

</html>