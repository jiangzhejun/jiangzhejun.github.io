<html>

<head>
  <link rel='stylesheet' href='../../inc/code.css'>
  <link rel='stylesheet' href='../../inc/default.css'>
  <meta charset="utf-8">
  <title>upack.java</title>
</head>

<body>
  <pre class='code'><span class='wbk_package_keyword'>package</span> bww.bill;

<span class='wbk_access_control'>public</span> <span class='wbk_difine_keyword'>class</span> upack {
  <span class='wbk_access_control'>private</span> <span class='wbk_types'>byte</span>[] content = <span class='wbk_constant'>null</span>;
  <span class='wbk_access_control'>private</span> <span class='wbk_types'>byte</span>[] data = <span class='wbk_constant'>null</span>;
  <span class='wbk_access_control'>private</span> <span class='wbk_types'>String</span> name = "";
  <span class='wbk_access_control'>private</span> <span class='wbk_types'>String</span> type = "";

  <span class='wbk_access_control'>public</span> upack(<span class='wbk_types'>byte</span>[] src, <span class='wbk_types'>String</span> fld) {
    <span class='wbk_types'>byte</span>[] b = <span class='wbk_constant'>null</span>;
    <span class='wbk_types'>int</span> x, y, z;

    <span class='wbk_process_control'>for</span> (x = 0; x &lt; src.length; x++) {
      <span class='wbk_process_control'>if</span> (src[x] == '&#92;n') {
        b = <span class='wbk_difine_keyword'>new</span> <span class='wbk_types'>byte</span>[x - 1];
        System.arraycopy(src, 0, b, 0, b.length);
        <span class='wbk_process_control'>break</span>;
      }
    }

    z = b.length + 2;

    <span class='wbk_process_control'>for</span> (x = z; x &lt; src.length; x++) {
      <span class='wbk_process_control'>for</span> (y = 0; y &lt; b.length; y++) {
        <span class='wbk_process_control'>if</span> (b[y] != src[x + y]) {
          <span class='wbk_process_control'>break</span>;
        }
      }
      <span class='wbk_process_control'>if</span> (y == b.length) {
        content = <span class='wbk_difine_keyword'>new</span> <span class='wbk_types'>byte</span>[x - 2 - z];
        System.arraycopy(src, z, content, 0, content.length);
        <span class='wbk_process_control'>if</span> (isField(fld)) {
          setData(content);
          setName(content);
          setType(content);
          <span class='wbk_process_control'>break</span>;
        } <span class='wbk_process_control'>else</span> {
          z += x;
        }
      }
    }
  }

  <span class='wbk_access_control'>private</span> <span class='wbk_types'>void</span> setType(<span class='wbk_types'>byte</span>[] src) {
    <span class='wbk_types'>byte</span>[] b = <span class='wbk_constant'>null</span>;
    <span class='wbk_types'>int</span> i = indexOf("Content-Type: ".getBytes(), src, 0),
        j = indexOf("&#92;r&#92;n&#92;r&#92;n".getBytes(), src, 0);

    <span class='wbk_process_control'>if</span> (i &gt; 0) {
      b = <span class='wbk_difine_keyword'>new</span> <span class='wbk_types'>byte</span>[j - i - 14];
      System.arraycopy(src, i + 14, b, 0, b.length);
      type = <span class='wbk_difine_keyword'>new</span> <span class='wbk_types'>String</span>(b);
    }
  }

  <span class='wbk_access_control'>private</span> <span class='wbk_types'>void</span> setName(<span class='wbk_types'>byte</span>[] src) {
    <span class='wbk_error_handle'>try</span> {
      <span class='wbk_types'>int</span> i = indexOf("; filename=&#92;"".getBytes(), src, 0),
          j = indexOf("&#92;"&#92;r&#92;n".getBytes(), src, 0);

      <span class='wbk_process_control'>if</span> (i &gt; 0) {
        <span class='wbk_types'>byte</span>[] b = <span class='wbk_difine_keyword'>new</span> <span class='wbk_types'>byte</span>[j - i - 12];
        System.arraycopy(src, i + 12, b, 0, b.length);
        name = <span class='wbk_difine_keyword'>new</span> <span class='wbk_types'>String</span>(b, "UTF-8");
      }
    } <span class='wbk_error_handle'>catch</span> (Exception e) {
      e.printStackTrace();
    }
  }

  <span class='wbk_access_control'>private</span> <span class='wbk_types'>void</span> setData(<span class='wbk_types'>byte</span>[] src) {
    <span class='wbk_types'>int</span> i = indexOf("&#92;r&#92;n&#92;r&#92;n".getBytes(), src, 0);
    <span class='wbk_types'>byte</span>[] b = <span class='wbk_difine_keyword'>new</span> <span class='wbk_types'>byte</span>[src.length - i - 4];
    System.arraycopy(src, i + 4, b, 0, b.length);
    data = b;
  }

  <span class='wbk_access_control'>private</span> <span class='wbk_types'>boolean</span> isField(<span class='wbk_types'>String</span> fld) {
    <span class='wbk_types'>byte</span>[] b = <span class='wbk_difine_keyword'>new</span> <span class='wbk_types'>byte</span>[indexOf("&#92;"".getBytes(), content, 38) - 38];
    System.arraycopy(content, 38, b, 0, b.length);
    <span class='wbk_process_control'>return</span> <span class='wbk_difine_keyword'>new</span> <span class='wbk_types'>String</span>(b).<span class='wbk_function_command'>equals</span>(fld);
  }

  <span class='wbk_access_control'>private</span> <span class='wbk_modify_keyword'>static</span> <span class='wbk_types'>int</span> indexOf(<span class='wbk_types'>byte</span>[] dest, <span class='wbk_types'>byte</span>[] src, <span class='wbk_types'>int</span> pos) {
    <span class='wbk_types'>int</span> i, j;

    <span class='wbk_process_control'>for</span> (i = pos; i &lt; src.length; i++) {
      <span class='wbk_process_control'>for</span> (j = 0; j &lt; dest.length; j++) {
        <span class='wbk_process_control'>if</span> (dest[j] != src[i + j]) {
          <span class='wbk_process_control'>break</span>;
        }
      }
      <span class='wbk_process_control'>if</span> (j &lt; dest.length) {
        <span class='wbk_process_control'>continue</span>;
      } <span class='wbk_process_control'>else</span> {
        <span class='wbk_process_control'>return</span> i;
      }
    }

    <span class='wbk_process_control'>return</span> -1;
  }

  <span class='wbk_access_control'>public</span> <span class='wbk_types'>String</span> getType() {
    <span class='wbk_process_control'>return</span> type;
  }

  <span class='wbk_access_control'>public</span> <span class='wbk_types'>String</span> getName() {
    <span class='wbk_process_control'>return</span> name;
  }

  <span class='wbk_access_control'>public</span> <span class='wbk_types'>byte</span>[] getData() {
    <span class='wbk_process_control'>return</span> data;
  }
}</pre>
</body>

</html>