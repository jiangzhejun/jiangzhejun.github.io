<html>

<head>
  <link rel='stylesheet' href='../../inc/code.css'>
  <link rel='stylesheet' href='../../inc/default.css'>
  <meta charset="utf-8">
  <title>图片加载错误的处理方法</title>
</head>

<body>
  <h1>图片加载错误的处理方法</h1><i>2021/5/14 北京</i><br><br>原本用于uFace2项目，因Linux服务器缺少字体，绘制出错，只好忍痛割爱。现专文公布，使其不被埋没。<br><br><pre class='code'>
<span class='wbk_access_control'>private</span> <span class='wbk_types'>byte</span>[] onError() <span class='wbk_error_handle'>throws</span> IOException {
  BufferedImage bi = <span class='wbk_difine_keyword'>new</span> BufferedImage(300, 300, BufferedImage.TYPE_INT_RGB);
  Font f = <span class='wbk_difine_keyword'>new</span> Font("Serif", Font.PLAIN, 210);
  Graphics2D g = bi.createGraphics();
  bi = g.getDeviceConfiguration().createCompatibleImage(300, 300, Transparency.TRANSLUCENT);
  g.dispose();
  g = bi.createGraphics();
  g.setColor(Color.GRAY);
  g.setFont(f);

  g.setRenderingHint(RenderingHints.KEY_ANTIALIASING, RenderingHints.VALUE_ANTIALIAS_ON);
  g.setStroke(<span class='wbk_difine_keyword'>new</span> BasicStroke(5f, BasicStroke.CAP_ROUND, BasicStroke.JOIN_ROUND, 3.5f, <span class='wbk_difine_keyword'>new</span> <span class='wbk_types'>float</span>[] { 15, 9 }, 0f));
  g.draw(<span class='wbk_difine_keyword'>new</span> RoundRectangle2D.<span class='wbk_types'>Float</span>(30, 30, 240, 240, 30, 30));

  FontMetrics fm = g.getFontMetrics();
  <span class='wbk_types'>String</span> s = "?";
  <span class='wbk_types'>int</span> sAscent = fm.getAscent(), sHeight = fm.getHeight(), sWidth = fm.stringWidth(s);

  g.setRenderingHint(RenderingHints.KEY_TEXT_ANTIALIASING, RenderingHints.VALUE_TEXT_ANTIALIAS_ON);
  g.drawString(s, (300 - sWidth) / 2, (300 - sHeight) / 2 + sAscent);
  g.dispose();

  ByteArrayOutputStream baos = <span class='wbk_difine_keyword'>new</span> ByteArrayOutputStream();
  ImageIO.write(bi, "png", baos);

  <span class='wbk_process_control'>return</span> baos.toByteArray();
}
</pre>
</body>

</html>